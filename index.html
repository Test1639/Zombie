<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Endless Zombie Shooter 2D</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: black;
      overflow: hidden;
      touch-action: manipulation;
    }

    canvas {
      display: block;
      margin: 0 auto;
      image-rendering: pixelated;
    }

    #mobile-controls {
      position: fixed;
      bottom: 20px;
      width: 100%;
      display: flex;
      justify-content: space-around;
      z-index: 100;
      padding: 0 20px;
      box-sizing: border-box;
    }

    .mobile-btn {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      color: white;
      font-weight: bold;
      font-size: 18px;
      display: flex;
      justify-content: center;
      align-items: center;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }

    #shoot-btn {
      background: rgba(255, 0, 0, 0.6);
    }

    #reload-btn {
      background: rgba(0, 150, 255, 0.6);
    }

    #debug-overlay {
      position: fixed;
      top: 10px;
      right: 10px;
      color: white;
      font-family: monospace;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <!-- Mobile controls -->
  <div id="mobile-controls">
    <div id="reload-btn" class="mobile-btn">RELOAD</div>
    <div id="shoot-btn" class="mobile-btn">FIRE</div>
  </div>

  <!-- Debug overlay -->
  <div id="debug-overlay"></div>

  <!-- Load Phaser -->
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>

  <!-- Main game script -->
  <script>
    const config = {
      type: Phaser.AUTO,
      width: 896,
      height: 512,
      render: {
        pixelArt: true
      },
      physics: {
        default: 'arcade',
        arcade: {
          gravity: { y: 0 },
          debug: false
        }
      },
      scene: {
        preload,
        create,
        update
      }
    };

    const game = new Phaser.Game(config);

    // Game variables
    let player, bullets, zombies, bg, mid, fg;
    let ammo = 6, score = 0, health = 100, reloading = false;
    let scoreText, ammoText, reloadText, healthBar;
    let zombieTimer = 0;
    let debugOverlay;

    function preload() {
      this.load.setPath('assets/');
      this.load.image('bg', 'background_layer.png');
      this.load.image('mid', 'midground_layer.png');
      this.load.image('fg', 'foreground_layer.png');
      this.load.image('soldier', 'soldier.png');
      this.load.image('zombie', 'zombie.png');
      this.load.image('bullet', 'bullet.png');

      // Fallback system
      this.load.on('loaderror', (file) => {
        console.warn(`Failed to load: ${file.key}`);
        const colors = {
          soldier: '#3498db',
          zombie: '#e74c3c',
          bullet: '#f1c40f',
          bg: '#2c3e50',
          mid: '#34495e',
          fg: '#7f8c8d'
        };

        const makeTex = (name, color) => {
          const tex = this.textures.createCanvas(name, 32, 32);
          tex.context.fillStyle = color;
          tex.context.fillRect(0, 0, 32, 32);
          tex.refresh();
        };

        if (!this.textures.exists(file.key) && colors[file.key]) {
          makeTex(file.key, colors[file.key]);
        }
      });
    }

    function create() {
      // Debug overlay
      debugOverlay = document.getElementById('debug-overlay');

      // Background layers
      bg = this.add.image(0, 0, 'bg').setOrigin(0).setDisplaySize(896, 512);
      mid = this.add.tileSprite(0, 0, 896, 512, 'mid').setOrigin(0).setDisplaySize(896, 512).setAlpha(0.6);
      fg = this.add.tileSprite(0, 0, 896, 512, 'fg').setOrigin(0).setDisplaySize(896, 512).setAlpha(0.8
